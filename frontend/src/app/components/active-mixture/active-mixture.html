<section class="panel-header" style="display: none;">
  <div class="panel-header__title">
    <p class="eyebrow">Stack composer</p>
    <h2>Active mixture</h2>
  </div>

  <button class="neon-button" type="button" (click)="triggerRun()" [disabled]="loading">
    <span>{{ loading ? 'Solvingâ€¦' : 'Pulse solver' }}</span>
    <span class="pulse-indicator" aria-hidden="true"></span>
  </button>
</section>

<section class="compound-list" *ngIf="compounds.length; else emptyState">
  <article 
    class="compound-row" 
    *ngFor="let compound of compounds; trackBy: trackByCompound"
    [class.expanded]="expandedCompoundId() === compound.id">
    
    <!-- Row Header (Always Visible) -->
    <div class="compound-row__header group flex h-14 w-full cursor-pointer items-center justify-between border-b border-white/5 px-4 hover:bg-white/5 transition-colors">
      
      <div class="flex items-center gap-3 overflow-hidden">
        <!-- Icon: Fixed width so it never shrinks -->
        <div class="flex h-8 w-8 shrink-0 items-center justify-center rounded bg-indigo-500/10 text-indigo-400">
          <div class="h-2 w-2 rounded-full bg-current"></div>
        </div>

        <!-- Text Wrapper: THE FIX IS HERE. min-w-0 forces flex child to respect text truncation -->
        <div class="flex flex-col min-w-0">
          <span class="truncate text-sm font-medium text-gray-200">
            {{ compound.name }}
          </span>
          <span class="truncate text-xs text-gray-500 font-mono">
            {{ compound.dosageMg }} mg/week
          </span>
        </div>
      </div>

      <!-- Toggle Switch: Pushed to the right -->
      <div class="shrink-0 pl-3">
        <div class="toggle-switch" [class.active]="compound.dosageMg > 0">
          <div class="toggle-knob"></div>
        </div>
      </div>
    </div>

    <!-- Expanded Details (Accordion) -->
    <div class="compound-row__details" *ngIf="expandedCompoundId() === compound.id">
      <div class="dosage-controls">
        <input
          type="range"
          min="0"
          max="400"
          step="5"
          [value]="compound.dosageMg"
          (input)="onDosageSliderChange(compound.id, $event)"
        />
        <input
          type="number"
          min="0"
          max="400"
          step="5"
          [value]="compound.dosageMg"
          (input)="onDosageInputChange(compound.id, $event)"
        />
      </div>

      <div class="compound-meta">
        <div>
          <span class="label">Ester</span>
          <span>{{ formatEster(compound.ester) }}</span>
        </div>
        <div>
          <span class="label">Absorption k<sub>a</sub></span>
          <span>{{ compound.absorptionK | number: '1.2-2' }}</span>
        </div>
        <div>
          <span class="label">Elimination k<sub>e</sub></span>
          <span>{{ compound.eliminationK | number: '1.2-2' }}</span>
        </div>
      </div>
    </div>
  </article>
</section>

<section class="duration-tile">
  <div>
    <p class="eyebrow">Mission duration</p>
    <div class="duration-value">
      <span>{{ durationDays }}</span>
      <small>days</small>
    </div>
  </div>
  <input
    type="range"
    class="duration-slider"
    [min]="durationRange.min"
    [max]="durationRange.max"
    [value]="durationDays"
    (input)="onDurationChange($event)"
  />
  <div class="duration-scale">
    <span>{{ durationRange.min }}d</span>
    <span>{{ durationRange.max }}d</span>
  </div>
</section>

<ng-template #emptyState>
  <div class="empty-state">
    <p>No active injectables configured.</p>
    <button type="button" class="ghost" (click)="refreshRequested.emit()">Load defaults</button>
  </div>
</ng-template>
