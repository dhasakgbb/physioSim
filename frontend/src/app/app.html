<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * * * The content below * * * * * * * * * * * -->
<ng-container *ngIf="vm() as vm">
  <!-- THE GRID: 3 Rigid Columns, No Gaps -->
  <div class="app-grid">
    <!-- COLUMN 1: LEFT SIDEBAR (Full Height) -->
    <div class="col-left">
      <!-- Fixed Header inside Sidebar -->
      <div class="sidebar-header">
        <span class="logo">physioSim</span>
        <span class="beta-badge">BETA</span>
      </div>

      <!-- Scrollable List Area -->
      <div class="sidebar-content">
        <app-active-mixture
          [compounds]="vm.compounds"
          [durationDays]="vm.durationDays"
          [loading]="vm.loading"
          (compoundUpdated)="onCompoundUpdated($event)"
          (durationChanged)="onDurationChanged($event)"
          (refreshRequested)="runSimulation()"
        ></app-active-mixture>
      </div>
    </div>

    <!-- COLUMN 2: CENTER CANVAS (The Stage) -->
    <div class="col-center">
      <!-- Canvas Header - The only place Navigation lives -->
      <header class="canvas-header">
        <!-- The Tabs -->
        <div class="nav-tabs">
          <button
            class="nav-tab"
            [class.active]="activeTab() === 'explore'"
            (click)="setActiveTab('explore')">
            Explore
          </button>
          <button
            class="nav-tab"
            [class.active]="activeTab() === 'optimize'"
            (click)="setActiveTab('optimize')">
            Optimize
          </button>
          <button
            class="nav-tab"
            [class.active]="activeTab() === 'signaling'"
            (click)="setActiveTab('signaling')">
            Signaling
          </button>
        </div>
      </header>

      <!-- The Chart Area - Edge to Edge -->
      <main class="canvas-body">
        <app-simulation-chart
          [dataPoints]="vm.dataPoints"
          [loading]="vm.loading"
          [activeTab]="activeTab()"
        ></app-simulation-chart>
      </main>
    </div>

    <!-- COLUMN 3: RIGHT INSPECTOR (The Data) -->
    <div class="col-right">
      <div class="inspector-content">
        <app-telemetry-hud [dataPoints]="vm.dataPoints"></app-telemetry-hud>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="vm.loading">
      <div class="scanner"></div>
      <span>Calibrating solverâ€¦</span>
    </div>
  </div>
</ng-container>

<router-outlet />
