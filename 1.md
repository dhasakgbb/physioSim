Nice, we’re building the *fun* tab — the one where the molecules start arguing with each other.

Let’s turn **Interactions** into a full subsystem, not just a cute chart.

---

## 1. Mental Model: How interactions work under the hood

Think in layers:

1. **Single-compound dose curves**
   For each compound `c` and effect dimension `k` (benefit or risk), you already have:

   * `B_c,k(d)` = benefit curve vs dose
   * `R_c,k(d)` = risk curve vs dose

2. **Stacked baseline (no interactions yet)**
   For a stack S = {c₁…cₙ} with doses dᵢ:

   * Aggregated benefit (per dimension):
     `B_base,k = Σ w_c,k * B_c,k(d_c)`
   * Aggregated risk:
     `R_base,k = Σ w_c,k * R_c,k(d_c)`
     where `w_c,k` are per-dimension weights (e.g., Tren has huge weight in “neurotoxicity”, smaller in “bloat”).

3. **Interaction layer**
   For each compound pair (i, j) and dimension k, you define:

   * **Synergy coefficient** `S_ij,k` (can be >0, <0, or 0)
   * **Penalty coefficient** `P_ij,k`
   * **Shape function** `f(d_i, d_j)` (usually some saturating form)

Then you compute:

* `ΔB_ij,k = S_ij,k * f(d_i, d_j)`
* `ΔR_ij,k = P_ij,k * f(d_i, d_j)`

and:

* `B_total,k = B_base,k + Σ_pairs ΔB_ij,k`
* `R_total,k = R_base,k + Σ_pairs ΔR_ij,k`

So “interactions” is literally a correction term added on top of your existing curves.

You’re not rewriting physics — you’re bending the dose-response surface.

---

## 2. Data Structures: How to encode interactions

Define a schema per compound and per interaction pair.

### Compound

```jsonc
{
  "name": "Testosterone",
  "code": "TEST",
  "class": "injectable",
  "base_effects": {
    "anabolic": {...},     // curve params
    "strength": {...},
    "libido": {...},
    "estrogenic": {...},
    "bloat": {...},
    "lipids": {...},
    "bp": {...},
    "neuro": {...}
  },
  "interactions": {
    "EQ": {
      "targets": ["anabolic", "vascularity", "bloat", "bp"],
      "synergy": {
        "anabolic": 0.35,
        "vascularity": 0.45
      },
      "penalty": {
        "bloat": 0.15,
        "bp": 0.25
      },
      "dose_model": "hill",
      "params": {
        "d50_i": 300,    // Test midpoint
        "d50_j": 400,    // EQ midpoint
        "n": 2.0         // cooperativity
      }
    },
    "TREN": {...},
    "MAST": {...}
  }
}
```

This gives you everything you need to compute corrections and drive UI.

---

## 3. Interaction Tab: UX Structure

Think of the tab in **three vertical bands**:

1. **Top: Interaction Matrix (Heatmap)**
2. **Middle: Overlaid Curves / Surface View**
3. **Bottom: Interaction Controls & Scenario Narratives**

### 3.1 Top: Interaction Heatmap

**Purpose:** Quick at-a-glance “where is the stack spicy?”

* X-axis: compound A
* Y-axis: compound B
* Cell color = **Interaction Intensity Index (I₍ᵢⱼ₎)**

Define something like:

`I_ij = α * |Σ_k S_ij,k| + β * |Σ_k P_ij,k|`

You can choose modes:

* **Mode: Benefit-Focused** (color → net positive synergy)
* **Mode: Risk-Focused** (color → net penalty)
* **Mode: Volatility** (big interactions of either sign)

**Behavior:**

* Hover a cell → tooltip:

  * “Test + EQ: Strong benefit synergy (lean mass, vascularity). Moderate risk (BP, RBC).”
* Click a cell → loads the pair into the middle “detail view” panel.

---

### 3.2 Middle: Overlaid Curves & 2D/3D Surfaces

Once a pair is selected (say Test + EQ), show:

#### A) Overlaid 1D Curves

Controls:

* Primary dose slider: e.g. Test dose (0–1,000 mg)
* Secondary dose slider: EQ dose (0–1,000 mg)

Charts:

1. **Benefit vs dose (with & without interaction)**

   * Line 1: Test alone (`B_Test,k(d_Test)`)
   * Line 2: EQ alone (`B_EQ,k(d_EQ)`)
   * Line 3: Naïve sum (no interaction)
   * Line 4: Total with interaction correction

2. **Risk vs dose (key dimensions)**

   * BP / hematocrit risk
   * Estrogenic / bloat risk
   * Lipids / neuro risk (depending on pair)

Single toggle to switch between outcome dimensions:

* `Anabolic`, `Cosmetic`, `Neuro`, `Cardio`, `Estrogenic/Bloat`

#### B) 2D Surface / Heatmap (optional advanced view)

Show a **dose–dose plane**:

* X-axis: compound A dose
* Y-axis: compound B dose
* Color: either `Net Benefit` or `Benefit/Risk ratio`

You can overlay:

* A white “ridge line” → local optima
* A red “danger zone” mask → high-risk region (e.g. BP, neuro)
  (thing that screams “maybe don’t go here, champ”)

---

### 3.3 Bottom: Interaction Controls (“Penalty Sliders” + Presets)

This is where it becomes an *engine*, not a graph.

#### A) User sensitivity sliders

Global across the app, but surfaced here:

* **Estrogen Sensitivity** (Low–High)
* **Water Retention Sensitivity**
* **Neuro Sensitivity** (anxiety, insomnia)
* **BP / Cardio Risk Sensitivity**

These map to multipliers:

* `P_ij,estrogenic *= estrogen_sensitivity_factor`
* `P_ij,neuro *= neuro_sensitivity_factor`
* etc.

So a high-anxiety user sees Tren + Mast interactions look spicier than a chill genetic freak.

#### B) Evidence weighting sliders

Some interactions are heavy on anecdote, light on trials.

Add per-pair slider:

* **“Evidence Mode”**

  * Clinical / mechanistic heavy (conservative)
  * Anecdote-enhanced (bro science + priors)

Mathematically:

* `S_ij,k = w_clinical * S_ij,k_clin + w_ane_cdote * S_ij,k_anc`
* same for `P_ij,k`

Expose that tradeoff explicitly and your tool feels **honest**.

#### C) Goal presets

* “Lean mass, moderate time horizon”
* “Photoshoot dryness, short term”
* “Recomp with joint friendliness”
* “Neuro-stable, libido-safe”

Selecting a goal does:

* Reweights benefit dimensions (`anabolic`, `cosmetic`, `joint`)
* Reweights risk dimensions (`neuro`, `BP`, `estrogenic`)

You then recompute the “Optimal Region” highlights on the surface plots.

---

## 4. Example Interactions in Detail

Let’s flesh out the three you mentioned with concrete logic.

---

### 4.1 Test + EQ (Synergy + RBC risk)

**Narrative:**

* EQ adds appetite, RBC, and a mild anabolic boost.
* Together they often “feel” more anabolic per mg than Test alone.
* Risks: hematocrit, BP, anxiety at higher doses; mild extra aromatase context.

**Model pieces:**

Dimensions:

* Benefits: `anabolic`, `vascularity`, `strength`
* Risks: `BP`, `hematocrit`, `bloat`, `anxiety`

Synergy term:

```math
f(d_T, d_EQ) = (d_T / (d_T + D_T50)) * (d_EQ / (d_EQ + D_EQ50))
```

Then:

* `ΔB_anabolic = S_ij,anabolic * f(d_T, d_EQ)`
* `ΔB_vascularity = S_ij,vascular * f(...)`

Penalties:

* `ΔR_BP = P_ij,BP * f(d_T, d_EQ)`
* `ΔR_hematocrit = P_ij,Hct * f(...)`

You can bias so synergy peaks at moderate doses and then flattens, while risk continues to climb.

UX specifics:

* Heatmap cell “Test + EQ”:

  * Color: Strong synergy, moderate risk.
* Pair detail:

  * Slider for “Maximum acceptable hematocrit risk”
  * When user increases both Test and EQ, display:

    * “You’re now in a region where extra EQ adds more risk than benefit. Consider increasing Test or duration instead.”

---

### 4.2 Tren + Mast (Dryness synergy, estrogen antagonism)

**Narrative:**

* Tren: insane anabolic efficiency + neuro/progestin side risk.
* Mast: mild anabolic, strong anti-estrogen / cosmetic hardness.
* Together: ultra-dry physique, but high risk of too-low estrogen + CNS strain.

Dimensions:

* Benefits: `cosmetic_dryness`, `strength`, `hardness`
* Risks: `neuro`, `estrogen_deficit`, `lipids`

Interaction model:

* `ΔB_cosmetic = big positive S_ij,cosmetic * f(d_TREN, d_MAST)`
* `ΔR_estrogen_deficit = P_ij,E_low * f(d_TREN, d_MAST)`
* `ΔR_neuro`: Mast might slightly modulate neuro perception; can be neutral or slight penalty.

Add a **conditional rule** for E2:

If user’s **base Test dose is low** (or if they have high Mast and Tren relative to Test):

* Increase `ΔR_estrogen_deficit` sharply
* Lower `libido` and `joint comfort` scores.

UX specifics:

* Warnings like:

  > “At this Test:Tren:Mast ratio, your modeled estrogen is likely very low.
  > Joint pain, low mood, and flat libido risk are elevated.”

* Add a vertical shaded “danger zone” on the dose plane where `E_deficit_score > threshold`.

---

### 4.3 NPP + Dbol (Joint comfort + bloat stack)

**Narrative:**

* NPP: joint-friendly, mild progestin risk, wet gains.
* Dbol: rapid strength, big bloat, hepatic + BP + estrogen risk.
* Together: “I am a water balloon but I’m strong” stack.

Dimensions:

* Benefits: `strength`, `joint_comfort`, `rate_of_gain`
* Risks: `bloat`, `BP`, `gyno`, `hepatic`

Interaction model:

* `ΔB_strength = S_ij,strength * f(d_NPP, d_DBOL)`
* `ΔB_joint_comfort = small positive (NPP-friendly effect)`

Penalties:

* `ΔR_bloat = large P_ij,bloat * f(...)`
* `ΔR_BP = large P_ij,BP * f(...)`
* `ΔR_gyno = increase if user’s E-sensitivity slider is high`

UX specifics:

* Heatmap cell: bright red in “risk view”.
* Pair view:

  * Show “Bloat vs Strength” trade-off curve.
  * Add slider: “Max acceptable bloat score”. Restrict recommended doses to region under that line.

---

## 5. “Interaction Penalty” Sliders: Behavior

These aren’t cosmetic — they literally shape the math.

Example:

* Estrogen sensitivity slider: `s_E` in [0.5, 2.0]

Then:

```python
for (i, j) in pairs:
    P_ij["estrogenic"] *= s_E
```

* Neuro sensitivity slider: `s_N`
  Applies to Tren, Superdrol, etc interactions.

* BP sensitivity slider: `s_BP`
  Strongly affects Test+EQ, NPP+Dbol, Anadrol, etc.

This makes the **same stack** look different for different users, which is both accurate and sticky.

---

## 6. Logic for Recommendations (“Engine Mode”)

Once interactions are modeled, you can build a **stack optimizer**.

Workflow:

1. User sets:

   * Compounds allowed (checkboxes)
   * Dose ranges per compound
   * Goal profile (weights for benefits/risks)

2. Engine samples the dose space (or runs a smart search):

   * For each combination:

     * Compute `B_total,k`, `R_total,k`, interactions included.

3. Compute:

   `Score = Σ_k w_B,k * B_total,k – Σ_k w_R,k * R_total,k`

4. Return:

   * Top N stack configurations
   * Visual highlight of the “good” area on the surface plots
   * Narrative like:

     > “For your profile and goals,
     > Test 350 + EQ 500 + Mast 300 gives 87% of maximum modeled benefit with 54% of maximum modeled risk. Increasing Test to 500 only improves benefit by 3% while increasing risk by 18%.”

That’s the moment where the UI feels *alive*.

---

## 7. UI Micro-details that make it feel premium

* Clicking an interaction heatmap cell animates the curves into place (subtle, 200ms).
* When risk crosses a threshold, the curve segment turns from cyan → amber → red.
* Tiny badge near the chart title:

  * “Interaction model: v0.3 • Evidence: Mixed • Updated 2025-10”
* Hover a curve → show which compound(s) dominate that region of the score.
* For power users, add a small “Model” button that opens the equation parameters for that pair (but not by default).

---

Putting it all together:

* **Heatmap** = “Where is the drama?”
* **Overlaid curves + 2D surfaces** = “How does the drama play out as I move doses?”
* **Penalty & goal sliders** = “Make it about *my* body and *my* risk tolerance.”
* **Engine mode** = “Don’t just show me; *help me choose*.”

That’s how you go from “some charts about stacks” to a **proper physioLab interaction engine** that lifters will keep revisiting every time they plan or tweak a cycle.
