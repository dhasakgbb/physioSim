# Outstanding Work After Stack Engine / Cycle Workspace Merge

The shared stack brain, guard-rail metadata, simple-vs-lab toggle, and cycle storage are in place. What’s left now is largely UI/UX debt from the earlier outline plus a bit of polish to make those new data hooks visible.

## 1. Chart-Level Guardrails
- ✅ `evaluateCompoundResponse` now feeds `value + ci + meta` into DoseResponse / Oral charts, plateau zones fade at the derived `plateauDose`, evidence caps draw dashed red segments, and `HoverAnalyticsTooltip` mirrors the guardrail copy. InteractionHeatmap sliders also read `pairEvaluation.byCompound.meta`, clamp in simple mode, and show the same plateau/evidence pills.
- ⏳ Remaining guardrail polish: extend `CustomLegend` so hovering a compound highlights its plateau/cap zone (per spec) and add a small guardrail badge to the sticky pair summary bar for quick scanning.

## 2. Interaction Tab Layout & Simple Mode
- ✅ Slider callouts now read `pairEvaluation.byCompound.meta`, clamp doses beyond the evidence cap, and show the same plateau / “outside evidence” chips that appear on the charts. Simple mode also displays the “Lab mode unlocks overrides” hint when sliders hit the cap.
- ⏳ Still need the structural reflow from the original spec: sticky pair summary bar, anchor-driven chunking (matrix → controls → metrics → charts → surfaces → optimizers), and auto-scroll when a pair or recommendation is selected. Simple mode must fully gate the heavy sections (lock evidence slider, hide dose sweep / surfaces / optimizers, reset their state when hidden) so the tab no longer feels like a single vertical gauntlet.

## 3. Injectables / Orals Tab Compression
- ✅ Tabs now follow the “Profile status → sticky control strip → hero chart → shared context drawer” stack: `ProfileStatusBar` replaced the inline panel (with a modal editor + lab toggle), `ChartControlBar` is the thin sticky strip with a filter indicator, the chart + legend share one hero card, and the “Need context?” drawer consolidates Quick Guide / Scenarios / Evidence Tier / EvidencePanel.
- ⏳ Follow-up: document the new interaction in README / screenshots, add the unsaved-profile warning badge the spec called out, and lazy-load the drawer’s heavy content (EvidencePanel) only after expansion to keep initial render lighter.

## 4. Cycle Workspace Polish
- ✅ The comparison card now emits the friendly narrative (“adds +0.8 cosmetic benefit… driven by …”), and both the orientation bar and saved-cycle grid surface cycle name, preset tag, and updated timestamp so there’s no guessing which record is active.
- ⏳ Follow-up: include ancillary/monitoring deltas in the narrative when those change, and add regression tests so copy regressions get caught automatically.

## 5. Test / UX Clean-Up
- ✅ `src/test/setup.js` stubs `localStorage` + `scrollTo`, StackBuilder tests render through `renderWithAct`, and the InteractionHeatmap snapshot is updated. `npx vitest run src/test/stackBuilder.test.jsx src/components/__tests__/InteractionHeatmap.test.jsx` now passes cleanly.
- ⏳ Document the new testing setup (README notes on the shim and act helper) and add guidance for future interaction tests so contributors continue to wrap user-event calls and avoid reintroducing act warnings.
